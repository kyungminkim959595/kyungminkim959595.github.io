<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://kyungminkim959595.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://kyungminkim959595.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-05-31T02:54:12+00:00</updated><id>https://kyungminkim959595.github.io/feed.xml</id><title type="html">Efficient ML Systems (EECE695E) Blog Post</title><subtitle>A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. </subtitle><entry><title type="html">How Does Classifier-free Guidance Amplify the Societal Bias in Text-to-image Diffusion Models?</title><link href="https://kyungminkim959595.github.io/blog/2025/cfg-bias/" rel="alternate" type="text/html" title="How Does Classifier-free Guidance Amplify the Societal Bias in Text-to-image Diffusion Models?"/><published>2025-05-27T00:00:00+00:00</published><updated>2025-05-27T00:00:00+00:00</updated><id>https://kyungminkim959595.github.io/blog/2025/cfg-bias</id><content type="html" xml:base="https://kyungminkim959595.github.io/blog/2025/cfg-bias/"><![CDATA[<h2 id="introduction">Introduction</h2> <h3 id="motivation">Motivation</h3> <p>Text-to-image (T2I) diffusion models have remarkable capabilities in generating realistic images from input text. <d-cite key="seshadri2024bias"></d-cite> However, there are growing concerns about their tendency to produce biased images toward specific demographic groups e.g. gender bias, skin tone bias, attribute bias, …. Because diffusion models learn from large-scale datasets that often encode social biases, they tend to generate images biased toward specific demographic groups. We address the bias amplification phenomenon such that a model’s outputs exhibit stronger biases than those present in its training data like Figure 1.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/ba_figure-480.webp 480w,/assets/img/cfg_ba/ba_figure-800.webp 800w,/assets/img/cfg_ba/ba_figure-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/ba_figure.png" class="img-fluid rounded z-depth-1" width="80%" height="auto" title="Figure 1. Case of bias amplification in Text-to-Image generation (Seshadri et al., 2024)" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>Which factors drive bias amplification in T2I diffusion models? We pinpoint Classifier-Free Guidance (CFG)—universally applied during T2I diffusion model generation—as a potential contributor. While CFG substantially improves image fidelity and alignment with the conditioning prompt, elevating its strength inherently diminishes sample diversity and biases generation toward prototypical outputs. In practice, users typically operate in the higher guidance‐scale range, adjusting the parameter to obtain their desired images.</p> <p>Recently, <d-cite key="kim2024rethinking"></d-cite> empirically demonstrated that higher CFG scales correspond to an increased prevalence of majority-group attributes, thereby identifying CFG intensity as a direct mechanism of bias amplification.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/cfg_ba-480.webp 480w,/assets/img/cfg_ba/cfg_ba-800.webp 800w,/assets/img/cfg_ba/cfg_ba-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/cfg_ba.png" class="img-fluid rounded z-depth-1" width="80%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 2. Source from Kim et al. (2024)</figcaption> </figure> </div> </div> <p>In this blog post, we analyze how Classifier‐Free Guidance (CFG) drives bias amplification in text‐to‐image diffusion models. Our work proceeds in three steps: (1) we formulate the problem by surveying prior research on CFG’s impact on model distributions; (2) we quantitatively assess the degree to which CFG contributes to bias amplification; and (3) we characterize the relationship between guidance scale and bias trends. We conducted our experimental analysis on the gender–occupation bias, a primary focus in fairness studies of text-to-image generative models.</p> <h2 id="preliminary">Preliminary</h2> <h3 id="group-fairness-and-bias-amplification">Group Fairness and Bias amplification</h3> <h4 id="group-fairness-in-generative-models">Group Fairness in Generative Models</h4> <p>In the context of generative models, group fairness generally refers to ensuring that the model’s outputs are demographically balanced across different protected attributes (e.g. gender, race, age). Traditional fairness metrics from supervised learning, such as demographic parity, are adopted to evaluate the group fairness of generative models. For example, in the occupation image generation task, we say that a generative model is gender-fair if it satisfies the following condition:</p> \[\mathbb{P}\left( \text{Image of a} ~ \{ \texttt{job} \} ~ | ~ \text{Subject is female} \right) \approx \mathbb{P}\left( \text{Image of a} ~ \{ \texttt{job} \} ~ | ~ \text{Subject is male} \right),\] <p>for every job candidate<d-footnote>Note that additional annotation for both the image label and the protected attribute is necessary for each generated image.</d-footnote>. While there is no universal definition of fairness <d-cite key="barocas2023fairness"></d-cite>, group fairness generally refers to a scenario in which the generative model’s output distribution is not biased toward any specific sub-population.</p> <h4 id="bias-amplification-in-generative-models">Bias Amplification in Generative Models</h4> <p>Bias amplification is the phenomenon where a model’s outputs exhibit stronger biases than those present in its training data <d-cite key="seshadri2024bias"></d-cite>. While such phenomena have been observed in text-to-image diffusion models such as Stable Diffusion, <d-cite key="seshadri2024bias"></d-cite> empirically demonstrated that in some cases, this may be due to prompt distribution shift-a mismatch between the captions used during training and the prompts provided at inference time. This finding highlights the importance of carefully evaluating bias amplification. Nevertheless, there is consensus that bias still persists in text-to-image diffusion models.</p> <h3 id="diffusion-model-and-classifier-free-guidance">Diffusion Model and Classifier-free guidance</h3> <p>Recent diffusion models belong to the family of score-based generative models and are formulated within the stochastic differential equation (SDE) framework.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/sde-480.webp 480w,/assets/img/cfg_ba/sde-800.webp 800w,/assets/img/cfg_ba/sde-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/sde.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 3. Visualization of Diffusion processes. Source from Song et al. (2021)</figcaption> </figure> </div> </div> <p>The forward process refers to perturbing the data distribution via a diffusion process. As indicated by the symmetric coloring of the density-representing boxes in the figure, the reverse process reconstructs the marginal distributions of the forward process at each time step. To generate images, one must solve the reverse SDE, which therefore requires an accurate estimate of the score function.</p> <p>Classifier‐Free Guidance (CFG) is a sampling strategy that employs an extrapolated score toward the conditional distribution, controlled by the guidance scale w, as follows. It pushes samples in the direction of higher \(p(y \mid x)\), but it does not directly correspond to the distribution \(p_w\).</p> <p>Here, it is important to note that the sampling distribution has deviated from the original data distribution. Bias amplification refers to the phenomenon in which a diffusion model’s sample distribution—expected in theory to follow the data distribution—actually exhibits an exacerbated bias. By applying CFG, however, the intended sampling distribution is inherently shifted from the pure data distribution to one weighted by both \(p(y∣x)\) and the guidance scale \(w\).</p> <p>Furthermore, we demonstrated in a simple setup (see Figure 4) that this shift acts to amplify bias in gender-occupation fairness. While the unconditional distribution corresponds to a single marginal distribution, the conditional distribution can exhibit higher or lower densities for specific groups depending on the conditioning variable \(y\).</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/gmm-480.webp 480w,/assets/img/cfg_ba/gmm-800.webp 800w,/assets/img/cfg_ba/gmm-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/gmm.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 4. Visualization of bias amplification in CFG</figcaption> </figure> </div> </div> <p>In the Experiments section, we empirically demonstrate that this tendency can indeed be observed in both text-to-image diffusion models and a toy example.</p> <hr/> <h2 id="experiment">Experiment</h2> <h3 id="t2i-diffusion-model--stable-diffusion">T2I diffusion model : Stable diffusion</h3> <h4 id="setting">Setting</h4> <p>We tested our hypothesis using the experimental setup of <d-cite key="seshadri2024bias"></d-cite>. The main procedure is as follows: we generate sets of images with Stable Diffusion v1.5 conditioned on prompts that include each target occupation. We then use a CLIP-based classifier to measure the gender distribution of the generated images and compare it against the gender proportions in the LAION training data. This process is repeated for each of the occupations listed below, varying the guidance scale 1~15 to observe how bias changes.</p> <ul> <li>Occupation list : <strong>skew to Male</strong>(’manager’, ‘scientist’, ‘poet’), <strong>fairly balanced</strong>(’dentist’, ‘painter’, ‘pharmacist’), <strong>skew to female</strong> (’dancer’, ‘hairdresser’, ‘pharmacist’)</li> </ul> <p>We varied the guidance scale to see its effect on bias amplification, which is defined as</p> \[BA_w(y) = | P_w (S = female | y) -0.5 | - | T (S = female | y) -0.5 |.\] <p>Here, $T(\cdot)$ denotes the data distribution and $P_w(\cdot)$ the model distribution with guidance scale $w$. And Guidance-induced bias amplification as a difference</p> \[BA_w(y) - BA_0(y)\] <h4 id="gender-distribution-and-bias-amplification">Gender distribution and Bias amplification</h4> <div class="row justify-content-sm-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/sd_plot1-480.webp 480w,/assets/img/cfg_ba/sd_plot1-800.webp 800w,/assets/img/cfg_ba/sd_plot1-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/sd_plot1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 5. Female ratio per guidance scale</figcaption> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/sd_plot2-480.webp 480w,/assets/img/cfg_ba/sd_plot2-800.webp 800w,/assets/img/cfg_ba/sd_plot2-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/sd_plot2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 6. Bias amplification per guidance scale</figcaption> </figure> </div> </div> <p>In Figures 5 and 6, we observe that for certain occupations, increasing the guidance scale drives the gender ratio further away from the balanced 0.5 mark, illustrating bias amplification. This effect is even more pronounced when viewed in each prompt’s individual plot, confirming that part of the previously reported bias amplification arises from CFG.</p> <p>Furthermore, in Figure 5, using a baseline female ratio of approximately 0.3–0.4 as a reference, we find that occupations with higher initial female proportions see further increases in female representation as guidance scale grows, whereas occupations with lower initial female proportions experience declines. This suggests that this corresponds to the marginal female proportion in the distribution, which is approximately 0.34—the average female ratio in Stable Diffusion reported by <d-cite key="cho2023dall"></d-cite>.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/dalleval-480.webp 480w,/assets/img/cfg_ba/dalleval-800.webp 800w,/assets/img/cfg_ba/dalleval-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/dalleval.png" class="img-fluid rounded z-depth-1" width="60%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 7. Gender ratio reported in Cho et al. (2023), -0.42 maps to 0.34 on a 0–1 scale.</figcaption> </figure> </div> </div> <h4 id="bias-amplifaction-through-guidance">Bias amplifaction through Guidance</h4> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/sd_plot3-480.webp 480w,/assets/img/cfg_ba/sd_plot3-800.webp 800w,/assets/img/cfg_ba/sd_plot3-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/sd_plot3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 8. Guidance-induced bias amplification per guidance scales</figcaption> </figure> </div> </div> <p>Therefore, to quantify the extent to which bias is amplified relative to the unconditional model’s gender distribution (female ratio = 0.34), we plotted Figure C using the following metric. We observe that the bias amplification values are positive for most occupations and tend to increase as the guidance scale grows, with the majority of the change occurring at lower guidance scales.</p> <h3 id="class-conditional-diffusion-model">Class conditional diffusion model</h3> <p>In this section, we replicate and validate the bias amplification trends observed in text-to-image diffusion models within a small-scale, class-conditional diffusion setting. We investigated gender–occupation bias by varying the red/green ratio for each digit in the Colored MNIST dataset. Therefore, digits can be viewed as occupations, and colors as genders.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/te_dt-480.webp 480w,/assets/img/cfg_ba/te_dt-800.webp 800w,/assets/img/cfg_ba/te_dt-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/te_dt.png" class="img-fluid rounded z-depth-1" width="60%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 9. Color ratio per digit</figcaption> </figure> </div> </div> <p>When we examined the bias amplification trend using a diffusion model trained on this dataset via the same procedure, the results showed clear amplification from the unconditional color ratio of 5:5—deviations further from the conditional distribution produced stronger amplification.</p> <div class="row justify-content-sm-center"> <div class="col-sm-10 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/te_plot1-480.webp 480w,/assets/img/cfg_ba/te_plot1-800.webp 800w,/assets/img/cfg_ba/te_plot1-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/te_plot1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 10. Red ratio per guidance scale, CFG experiment</figcaption> </figure> </div> </div> <p>We observed the same pattern under Classifier Guidance, and when we reversed the color ratios during dataset synthesis, the direction of the bias change also reversed. This illustrates that the conditional distribution \(p(y \mid x)\) used for guidance exerts a significant influence on the distribution of guided diffusion models, depending on the guidance scale.</p> <div class="row justify-content-sm-center"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/te_plot2-480.webp 480w,/assets/img/cfg_ba/te_plot2-800.webp 800w,/assets/img/cfg_ba/te_plot2-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/te_plot2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 11. Red ratio per guidance scale with classifier trained on original data, CG experiment</figcaption> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/cfg_ba/te_plot3-480.webp 480w,/assets/img/cfg_ba/te_plot3-800.webp 800w,/assets/img/cfg_ba/te_plot3-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/cfg_ba/te_plot3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 12. Red ratio per guidance scale with classifier trained on color-inverted data, CG experiment</figcaption> </figure> </div> </div> <hr/> <h2 id="discussion">Discussion</h2> <p>In this blog post, we empirically assessed the impact of CFG on bias amplification in T2I diffusion models, demonstrating that CFG amplifies bias by extrapolating</p> <p>the conditional distribution further away from the unconditional distribution.</p> <p>The limitations not addressed in this post are as follows:</p> <ul> <li>The numerical values cannot be considered strictly precise because our evaluation operates on high-dimensional, complex text-conditioned distributions.</li> <li>Images generated at low guidance scales often fail to form properly, making those measurements less reliable. Since we assigned gender by mapping each image to the closest class using a CLIP classifier, the CLIP model’s own biases may have influenced our results.</li> </ul> <p>To address these, we validated the observed trends using toy examples.</p> <p>Through this blog post, we emphasize that group-fairness research for diffusion models must address the effects of CFG, and more broadly, that debiasing low-temperature sampling strategies is essential for generative models.</p> <ul> <li>In most of the papers I have reviewed so far, there is little to no discussion of CFG’s impact on bias amplification, often missing their experimental set-ups.</li> <li>As shown in <d-cite key="kim2024rethinking" style="display:inline"></d-cite> who previously identified the same problem, proposed a solution that attenuates bias in the text-condition embeddings of the text-conditional component. We approached the problem from a slightly different angle, framing it as the disparity in bias levels for the attribute between the conditional distribution and the unconditional distribution.</li> <li>Our proposal is to reduce this disparity, and we believe that one promising direction is to leverage Autoguidance—one of the recent state-of-the-art CFG methods. This methodology leverages the conditional distribution of a weaker model rather than the unconditional distribution. However, it still does not resolve which weaker model should be employed within T2I diffusion frameworks, necessitating further research.</li> </ul> <p>We have always considered fairness only with respect to \(p(x \mid y)\), but for practical applications, fairness in \(p(y \mid x)\) must also be taken into account.</p> <hr/>]]></content><author><name>Myeongsoo Kim</name></author><category term="CFG"/><category term="diffusion_model"/><category term="bias"/><summary type="html"><![CDATA[Classifier-Free Guidance (CFG) is a potential driver of bias amplification in text-to-image (T2I) diffusion models. We analyzed the magnitude and pattern of CFG-induced bias amplification.]]></summary></entry></feed>